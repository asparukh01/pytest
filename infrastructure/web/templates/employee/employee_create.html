{% extends 'base.html' %}
{% load static %}

{% block title %}Добавить сотрудника{% endblock %}

{% block content %}
    <h1 class="mb-4">Добавить сотрудника</h1>
    <hr>
    <div class="card border-secondary">
        <div class="card-body">
            {% include 'partials/employee/employee_form.html' with button_text="Создать" %}
        </div>
    </div>
    <script>
        var tpID = {{ tpID }};
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="{% static 'celery_progress/celery_progress.js' %}"></script>
    <script>
        $(function () {
            $("#emp").on("submit", (e) => {
                e.preventDefault()
                let formData = new FormData($("#emp")[0])
                //formData.append('csrfmiddleware', "{% csrf_token %}")
                $.ajax({
                    type: "POST",
                    url: "",
                    data: formData,
                    contentType: false,
                    processData: false,
                    cache: false,
                    async: true,
                    success: function (res) {
                        var taskId = res.task_id
                        if (taskId){
                            alert('Загрузка выполнено на 100%')
                            window.location.replace('{% url 'home' orgID=1 tpID=tpID %}')
                        }
                    },
                    error: function (err) {
                        console.log(err);
                    },
                })
            })
        });
        $('#employee_IIN').on('input', function () {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    </script>
{% endblock content %}
